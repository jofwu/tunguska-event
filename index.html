<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
		<title>Tunguska Event</title>

		<!-- Bootstrap -->
		<link href="./node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>
	<body>
		<div class="container">
			<div class="row">
				<div class="col-md-12">
					<h1>Navigator <small>A suborbital hop calculator</small></h1>
				</div>
			</div>

			<div class="row">
				<div class="col-md-6">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h3 class="panel-title">Input</h3>
						</div>
						<form class="panel-body" id-"form_input">
							<div class="form-group">
								<label for="starting_position">Starting Position <small>Example: -37.1336 N, 109.3768 W</small></label>
								<input type="text" id="starting_position" class="form-control"/>
							</div>
							<div class="form-group">
								<label for="starting_asl">Starting Altitude Above Sea Level <small>Example: 213m</small></label>
								<input type="text" id="starting_asl" class="form-control"/>
							</div>							
							<div class="form-group">
								<label for="target_position">Target Position <small>Example: -37.1336 N, 109.3768 W</small></label>
								<input type="text" id="target_position" class="form-control"/>
							</div>
							<div class="form-group">
								<label for="target_asl">Target Altitude Above Sea Level <small>Example: 213m</small></label>
								<input type="text" id="target_asl" class="form-control"/>
							</div>
							<div class="form-group">
								<label for="body_select">Body</label>
								<select class="form-control" id="body_select">
									<optgroup label="Stock System">
										<option value="Bop">Bop</option>
										<option value="Dres">Dres</option>
										<option value="Duna">Duna</option>
										<option value="Eeloo">Eeloo</option>
										<option value="Eve">Eve</option>
										<option value="Gilly">Gilly</option>
										<option value="Ike">Ike</option>
										<option value="Jool">Jool</option>
										<option value="Kerbin">Kerbin</option>
										<option value="Kerbol">Kerbol</option>
										<option value="Laythe">Laythe</option>
										<option value="Minmus">Minmus</option>
										<option value="Moho">Moho</option>
										<option value="Mun">Mun</option>
										<option value="Pol">Pol</option>
										<option value="Tylo">Tylo</option>
										<option value="Vall">Vall</option>
 									</optgroup>
								</select>
							</div>
							<div class="btn-group">
								<button type="button" class="btn btn-default">Reset</button>
								<button type="button" class="btn btn-success">Calculate</button>
							</div>

							<div class="progress" style="margin-top:15px;margin-bottom:0">
								<div class="progress-bar progress-bar-success progress-bar-striped active" id="progress_bar" style="width: 35%">
									
								</div>
							</div>
						</form>
					</div>
				</div>
				<div class="col-md-6">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h3 class="panel-title">Trajectory</h3>
						</div>
						<form class="panel-body">
							<div class="form-group">
								<label for="starting_position">Heading (degrees)</label>
								<input type="text" id="heading_output" class="form-control" disabled value="47&deg; east from North" />
							</div>
							<div class="form-group">
								<label for="target_position">Pitch (degrees)</label>
								<input type="text" id="pitch_output" class="form-control" disabled value="37&deg; above the horizon" />
							</div>
							<div class="form-group">
								<label for="target_position">Delta-V Required</label>
								<input type="text" id="deltav_output" class="form-control" disabled value="1.56km/s" />
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>

		<script src="./node_modules/jquery/dist/jquery.min.js"></script>
		<script src="./node_modules/jquery-mask-plugin/dist/jquery.mask.min.js"></script>
		<script src="./node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
		<script>
$(function() {
	var form = $('#form_input');

	var progress_bar = $('#progress_bar');

	var geo_mask = "S0D.0DDD N, S0DD.0DDD W";
	var pattern = {
		translation: {
			'S': { // sign
				pattern: /\-?/
			},
			'D': { // optional digit
				pattern: /\d/,
				optional: true
			}
		}
	}

	// Converts from degrees to radians.
	Math.radians = function(degrees) {
		return degrees * Math.PI / 180;
	};
	 
	// Converts from radians to degrees.
	Math.degrees = function(radians) {
		return radians * 180 / Math.PI;
	};

	var source_position_input = $('#starting_position');
	source_position_input.mask(geo_mask, pattern);
	
	var source_asl = $('#starting_asl');
	source_asl.mask('0DDDm', pattern);

	var target_position_input = $('#target_position');
	target_position_input.mask(geo_mask, pattern);

	var target_asl = $('#starting_asl');
	target_asl.mask('0DDDm', pattern);

	var preset_input = $('#body_select');

	var heading_output = $('#heading_output');
	var pitch_output = $('#pitch_output');
	var deltav_output = $('#deltav_output');

	var presets = {
		bop: {},
		dres: {},
		duna: {},
		eeloo: {},
		eve: {},
		gilly: {},
		ike: {},
		jool: {},
		kerbin: {},
		kerbol: {},
		laythe: {},
		minmus: {},
		moho: {},
		mun: {G: 6.51e10, R: 2e4},
		pol: {},
		tylo: {},
		vall: {},
	}

	function calculate(){
		var body = presets.mun;

		function calculate_bearing(lat_1, lon_1, lat_2, lon_2){
			return Math.atan2(
				Math.cos(lat_1)*Math.sin(lat_2) - Math.sin(lat_1)*Math.cos(lat_2)*Math.cos(lon_2 - lon_1),
				Math.sin(lon_2 - lon_1)*Math.cos(lat_2)
			);
		}

		var lat_1 = Math.radians(50.0);
		var lon_1 = Math.radians(-123.45);

		var lat_2 = Math.radians(70.0);
		var lon_2 = Math.radians(-43.45);
		set_heading(Math.degrees(calculate_bearing(lat_1, lon_1, lat_2, lon_2)));
	}

	function set_error(which, is_error){ // which = jquery element, is_error = true/false
		if (is_error){
			which.addClass('has-error').removeClass('has-success');
		} else {
			which.addClass('has-success').removeClass('has-error');
		}
	}

	function set_progress(complete){
		progress_bar.width(complete);
	}

	function set_heading(heading){
		heading_output.val(heading.toFixed(1) + "° east from North");
	}

	function set_pitch(pitch){
		pitch_output.val(pitch.toFixed(1) + "° above the horizon");
	}

	// testing
	set_error(target_position_input, true);
	set_progress('57%');
	calculate();
	set_pitch(47);
});
		</script>
	</body>
</html>